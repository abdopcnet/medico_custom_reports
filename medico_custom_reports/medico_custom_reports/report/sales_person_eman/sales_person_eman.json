{
 "add_total_row": 1,
 "add_translate_data": 0,
 "columns": [],
 "creation": "2025-12-16 23:23:44.691516",
 "disabled": 0,
 "docstatus": 0,
 "doctype": "Report",
 "filters": [],
 "idx": 0,
 "is_standard": "Yes",
 "json": "{\"columns\":[{\"fieldname\":\"sales_invoice\",\"label\":\"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629\",\"fieldtype\":\"Link\",\"options\":\"Sales Invoice\",\"id\":\"sales_invoice\",\"name\":\"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"company\",\"label\":\"\u0627\u0644\u0634\u0631\u0643\u0629\",\"fieldtype\":\"Link\",\"options\":\"Company\",\"id\":\"company\",\"name\":\"\u0627\u0644\u0634\u0631\u0643\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"customer\",\"label\":\"\u0627\u0644\u0639\u0645\u064a\u0644\",\"fieldtype\":\"Link\",\"options\":\"Customer\",\"id\":\"customer\",\"name\":\"\u0627\u0644\u0639\u0645\u064a\u0644\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"customer_group\",\"fieldtype\":\"Link\",\"label\":\"Customer Group\",\"insert_after_index\":2,\"link_field\":{\"fieldname\":\"customer\",\"names\":{}},\"doctype\":\"Customer\",\"options\":\"Customer Group\",\"width\":100,\"id\":\"customer_group\",\"name\":\"Customer Group\",\"editable\":false,\"compareValue\":null},{\"fieldname\":\"posting_date\",\"label\":\"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u062b\u0628\u0627\u062a\",\"fieldtype\":\"Date\",\"id\":\"posting_date\",\"name\":\"\u062a\u0627\u0631\u064a\u062e \u0627\u0644\u0625\u062b\u0628\u0627\u062a\",\"width\":null,\"editable\":false},{\"fieldname\":\"customer_invoice_reference_no\",\"label\":\"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0645\u062e\u0635\u0635\",\"fieldtype\":\"Data\",\"id\":\"customer_invoice_reference_no\",\"name\":\"\u0631\u0642\u0645 \u0627\u0644\u0641\u0627\u062a\u0648\u0631\u0629 \u0627\u0644\u0645\u062e\u0635\u0635\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"grand_total\",\"label\":\"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a\",\"fieldtype\":\"Currency\",\"id\":\"grand_total\",\"name\":\"\u0627\u0644\u0625\u062c\u0645\u0627\u0644\u064a\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"subtotal_without_vat\",\"label\":\"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a \u0628\u062f\u0648\u0646 \u0636\u0631\u064a\u0628\u0629\",\"fieldtype\":\"Currency\",\"id\":\"subtotal_without_vat\",\"name\":\"\u0627\u0644\u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0641\u0631\u0639\u064a \u0628\u062f\u0648\u0646 \u0636\u0631\u064a\u0628\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"sales_person\",\"label\":\"\u0645\u0646\u062f\u0648\u0628 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a\",\"fieldtype\":\"Link\",\"options\":\"Sales Person\",\"id\":\"sales_person\",\"name\":\"\u0645\u0646\u062f\u0648\u0628 \u0627\u0644\u0645\u0628\u064a\u0639\u0627\u062a\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"commission_rate\",\"label\":\"\u0646\u0633\u0628\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629 (%)\",\"fieldtype\":\"Percent\",\"id\":\"commission_rate\",\"name\":\"\u0646\u0633\u0628\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629 (%)\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"total_paid\",\"label\":\"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u062f\u0641\u0648\u0639\",\"fieldtype\":\"Currency\",\"id\":\"total_paid\",\"name\":\"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u062f\u0641\u0648\u0639\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"total_papers\",\"label\":\"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0623\u0648\u0631\u0627\u0642\",\"fieldtype\":\"Int\",\"id\":\"total_papers\",\"name\":\"\u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0623\u0648\u0631\u0627\u0642\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"stamp_value\",\"label\":\"\u0642\u064a\u0645\u0629 \u0627\u0644\u062f\u0645\u063a\u0629\",\"fieldtype\":\"Currency\",\"id\":\"stamp_value\",\"name\":\"\u0642\u064a\u0645\u0629 \u0627\u0644\u062f\u0645\u063a\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"net_amount_paid\",\"label\":\"\u0635\u0627\u0641\u064a \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639\",\"fieldtype\":\"Currency\",\"id\":\"net_amount_paid\",\"name\":\"\u0635\u0627\u0641\u064a \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u0645\u062f\u0641\u0648\u0639\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"amount_eligible_for_commission\",\"label\":\"\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0627\u0636\u0639 \u0644\u0644\u0639\u0645\u0648\u0644\u0629\",\"fieldtype\":\"Currency\",\"id\":\"amount_eligible_for_commission\",\"name\":\"\u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0627\u0636\u0639 \u0644\u0644\u0639\u0645\u0648\u0644\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null},{\"fieldname\":\"incentives\",\"label\":\"\u0642\u064a\u0645\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629\",\"fieldtype\":\"Currency\",\"id\":\"incentives\",\"name\":\"\u0642\u064a\u0645\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629\",\"width\":null,\"editable\":false,\"compareValue\":null}],\"filters\":{\"from_date\":\"2025-11-01\",\"to_date\":\"2025-11-30\"}}",
 "letter_head": null,
 "modified": "2025-12-16 23:23:47.712061",
 "modified_by": "Administrator",
 "module": "Medico Custom Reports",
 "name": "Sales_person_eman",
 "owner": "Administrator",
 "prepared_report": 0,
 "query": "WITH invoice_payments AS (\r\n    SELECT\r\n        per.reference_name AS invoice_name,\r\n        SUM(per.allocated_amount) AS total_paid\r\n    FROM `tabPayment Entry` pe\r\n    JOIN `tabPayment Entry Reference` per ON per.parent = pe.name\r\n    WHERE pe.docstatus = 1\r\n      AND per.reference_doctype = 'Sales Invoice'\r\n    GROUP BY per.reference_name\r\n),\r\n\r\ninvoice_papers AS (\r\n    SELECT\r\n        per.reference_name AS invoice_name,\r\n        SUM(pe.custom_\u0639\u062f\u062f_\u0627\u0648\u0631\u0627\u0642_\u0627\u0644\u0639\u0642\u062f) AS total_contract_papers\r\n    FROM `tabPayment Entry` pe\r\n    JOIN `tabPayment Entry Reference` per ON per.parent = pe.name\r\n    WHERE pe.docstatus = 1\r\n      AND per.reference_doctype = 'Sales Invoice'\r\n    GROUP BY per.reference_name\r\n),\r\n\r\ninvoice_vat AS (\r\n    SELECT\r\n        parent AS invoice_name,\r\n        SUM(base_tax_amount_after_discount_amount) AS invoice_vat_total\r\n    FROM `tabSales Taxes and Charges`\r\n    WHERE docstatus = 1\r\n    GROUP BY parent\r\n),\r\n\r\nsales_persons AS (\r\n    SELECT\r\n        parent AS invoice_name,\r\n        sales_person\r\n    FROM `tabSales Team`\r\n    WHERE parenttype = 'Sales Invoice'\r\n)\r\n\r\nSELECT\r\n    si.name AS sales_invoice,\r\n    si.company,\r\n    si.customer,\r\n\r\n    /* \u0646\u0648\u0639 \u0627\u0644\u0639\u0645\u064a\u0644 (\u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u0639\u0645\u064a\u0644) */\r\n    c.customer_group AS customer_group,\r\n\r\n    si.posting_date,\r\n    si.custom_sales_invoice_number AS customer_invoice_reference_no,\r\n\r\n    /* \u0627\u0644\u0645\u0628\u0627\u0644\u063a */\r\n    si.grand_total,\r\n    (si.grand_total - si.total_taxes_and_charges) AS subtotal_without_vat,\r\n\r\n    /* \u0625\u062c\u0645\u0627\u0644\u064a \u0627\u0644\u0645\u062f\u0641\u0648\u0639 */\r\n    COALESCE(ip.total_paid, 0) AS total_paid,\r\n\r\n    /* \u0627\u0644\u0645\u0628\u0644\u063a \u0627\u0644\u062e\u0627\u0636\u0639 \u0644\u0644\u0639\u0645\u0648\u0644\u0629 */\r\n    CASE\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0642\u0648\u0627\u062a \u0645\u0633\u0644\u062d\u0629' THEN\r\n            (\r\n                (\r\n                    COALESCE(ip.total_paid, 0) -\r\n                    (\r\n                        COALESCE(ip.total_paid, 0) * 0.01 +\r\n                        (\r\n                            (\r\n                                CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                                CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                            ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                        ) +\r\n                        (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                        (\r\n                            (COALESCE(iv.invoice_vat_total, 0) * 0.20) *\r\n                            (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                        )\r\n                    )\r\n                )\r\n                - COALESCE(iv.invoice_vat_total, 0)\r\n            )\r\n\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062d\u0643\u0648\u0645\u064a \u0648\u0627\u0644\u062c\u0627\u0645\u0639\u064a' THEN\r\n            (\r\n                (\r\n                    COALESCE(ip.total_paid, 0) -\r\n                    (\r\n                        COALESCE(ip.total_paid, 0) * 0.01 +\r\n                        (\r\n                            (\r\n                                CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                                CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                                CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                            ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                        ) +\r\n                        (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                        (\r\n                            (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                        )\r\n                    )\r\n                )\r\n                - COALESCE(iv.invoice_vat_total, 0)\r\n            )\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062e\u0627\u0635' THEN\r\n            (\r\n                COALESCE(ip.total_paid, 0) \r\n                - (COALESCE(ip.total_paid, 0) * 0.01)   --\r\n                - COALESCE(iv.invoice_vat_total, 0)     -- \u062e\u0635\u0645 \u0636\u0631\u064a\u0628\u0629 \u0627\u0644\u0642\u064a\u0645\u0629 \u0627\u0644\u0645\u0636\u0627\u0641\u0629\r\n            )\r\n\r\n        ELSE\r\n            (\r\n                (\r\n                    COALESCE(ip.total_paid, 0) \r\n                   \r\n                )\r\n                - COALESCE(iv.invoice_vat_total, 0)\r\n            )\r\n    END AS amount_eligible_for_commission,\r\n    \r\n    /* \u0646\u0633\u0628\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629 \u0645\u0646 Sales Team */\r\n    COALESCE(st.commission_rate, 0) AS commission_rate,\r\n\r\n    /* \u0642\u064a\u0645\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629 */\r\n    (\r\n        CASE\r\n            WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0642\u0648\u0627\u062a \u0645\u0633\u0644\u062d\u0629' THEN\r\n                (\r\n                    (\r\n                        COALESCE(ip.total_paid, 0) -\r\n                        (\r\n                            COALESCE(ip.total_paid, 0) * 0.01 +\r\n                            (\r\n                                (\r\n                                    CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                                ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                            ) +\r\n                            (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                            (\r\n                                (COALESCE(iv.invoice_vat_total, 0) * 0.20) *\r\n                                (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                            )\r\n                        )\r\n                    )\r\n                    - COALESCE(iv.invoice_vat_total, 0)\r\n                )\r\n\r\n            WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062d\u0643\u0648\u0645\u064a \u0648\u0627\u0644\u062c\u0627\u0645\u0639\u064a' THEN\r\n                (\r\n                    (\r\n                        COALESCE(ip.total_paid, 0) -\r\n                        (\r\n                            COALESCE(ip.total_paid, 0) * 0.01 +\r\n                            (\r\n                                (\r\n                                    CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                                    CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                                    CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                                ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                            ) +\r\n                            (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                            (\r\n                                (COALESCE(iv.invoice_vat_total, 0) * 0.20) *\r\n                                (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                            )\r\n                        )\r\n                    )\r\n                    - COALESCE(iv.invoice_vat_total, 0)\r\n                )\r\n\r\n          WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062e\u0627\u0635' THEN\r\n            (\r\n                COALESCE(ip.total_paid, 0) \r\n                - (COALESCE(ip.total_paid, 0) * 0.01)   --\r\n                - COALESCE(iv.invoice_vat_total, 0)     -- \u062e\u0635\u0645 \u0636\u0631\u064a\u0628\u0629 \u0627\u0644\u0642\u064a\u0645\u0629 \u0627\u0644\u0645\u0636\u0627\u0641\u0629\r\n            )\r\n\r\n            ELSE\r\n         \r\n            (\r\n                COALESCE(ip.total_paid, 0) \r\n              \r\n            )\r\n\r\n        END\r\n        * (COALESCE(st.commission_rate, 0) / 100)\r\n    ) AS incentives,\r\n\r\n    /* \u0645\u062c\u0645\u0648\u0639 \u0627\u0644\u0623\u0648\u0631\u0627\u0642 \u0645\u0646 \u062c\u0645\u064a\u0639 \u0627\u0644\u062f\u0641\u0639\u0627\u062a */\r\n    COALESCE(ipapers.total_contract_papers, 0) AS total_papers,\r\n\r\n    /* \u0642\u064a\u0645\u0629 \u0627\u0644\u062f\u0645\u063a\u0629 */\r\n    (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) AS stamp_value,\r\n\r\n    /* \u0627\u0644\u0645\u0646\u062f\u0648\u0628 */\r\n    sp.sales_person,\r\n\r\n    /* Net payable \u0627\u0644\u0645\u0639\u062f\u0644 */\r\n    CASE\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0642\u0648\u0627\u062a \u0645\u0633\u0644\u062d\u0629' THEN\r\n            (\r\n                COALESCE(ip.total_paid, 0) -\r\n                (\r\n                    COALESCE(ip.total_paid, 0) * 0.01 +\r\n                    (\r\n                        (\r\n                            CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                            CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                        ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                    ) +\r\n                    (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                    (\r\n                        (COALESCE(iv.invoice_vat_total, 0) * 0.20) *\r\n                        (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                    )\r\n                )\r\n            )\r\n\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062d\u0643\u0648\u0645\u064a \u0648\u0627\u0644\u062c\u0627\u0645\u0639\u064a' THEN\r\n            (\r\n                COALESCE(ip.total_paid, 0) -\r\n                (\r\n                    COALESCE(ip.total_paid, 0) * 0.01 +\r\n                    (\r\n                        (\r\n                            CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                            CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                        ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                    ) +\r\n                    (COALESCE(ipapers.total_contract_papers, 0) * 3 * 0.90) +\r\n                    (\r\n                        (COALESCE(iv.invoice_vat_total, 0) * 0.20) *\r\n                        (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                    )\r\n                )\r\n            )\r\n\r\n        WHEN c.customer_group = '\u0645\u0633\u062a\u0634\u0641\u064a\u0627\u062a \u0627\u0644\u0642\u0637\u0627\u0639 \u0627\u0644\u062e\u0627\u0635' THEN\r\n            (\r\n                COALESCE(ip.total_paid, 0) -\r\n                (\r\n                    COALESCE(ip.total_paid, 0) * 0.01 +\r\n                    (\r\n                        (\r\n                            CASE WHEN si.grand_total BETWEEN 51 AND 250  THEN (si.grand_total - 50) * 0.048 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 251 AND 500  THEN (si.grand_total - 50) * 0.052 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 501 AND 1000 THEN (si.grand_total - 50) * 0.056 ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 1001 AND 5000 THEN (si.grand_total - 50) * 0.06  ELSE 0 END +\r\n                            CASE WHEN si.grand_total BETWEEN 5001 AND 10000 THEN (si.grand_total - 50) * 0.064 ELSE 0 END +\r\n                            CASE WHEN si.grand_total > 10000              THEN (si.grand_total - 50) * 0.024 ELSE 0 END\r\n                        ) * (CASE WHEN si.grand_total > 0 THEN COALESCE(ip.total_paid, 0) / si.grand_total ELSE 0 END)\r\n                    )\r\n                )\r\n            )\r\n\r\n        ELSE\r\n         \r\n            (\r\n                COALESCE(ip.total_paid, 0) \r\n                - (COALESCE(ip.total_paid, 0) * 0.01)   --\r\n                - COALESCE(iv.invoice_vat_total, 0)     -- \u062e\u0635\u0645 \u0636\u0631\u064a\u0628\u0629 \u0627\u0644\u0642\u064a\u0645\u0629 \u0627\u0644\u0645\u0636\u0627\u0641\u0629\r\n            )\r\n\r\n    END AS net_amount_paid\r\n\r\nFROM `tabSales Invoice` si\r\nLEFT JOIN invoice_payments  ip      ON ip.invoice_name      = si.name\r\nLEFT JOIN invoice_papers    ipapers ON ipapers.invoice_name = si.name\r\nLEFT JOIN invoice_vat       iv      ON iv.invoice_name      = si.name\r\nLEFT JOIN sales_persons     sp      ON sp.invoice_name      = si.name\r\n\r\n/* \u0647\u0646\u0627 \u0627\u0644\u0631\u0628\u0637 \u0627\u0644\u0635\u062d\u064a\u062d \u0644\u0645\u062c\u0645\u0648\u0639\u0629 \u0627\u0644\u0639\u0645\u064a\u0644 */\r\nLEFT JOIN `tabCustomer`        c  ON c.name = si.customer\r\nLEFT JOIN `tabCustomer Group`  cg ON cg.name = c.customer_group\r\n\r\n/* \u0647\u0646\u0627 \u0627\u0644\u0631\u0628\u0637 \u0627\u0644\u0635\u062d\u064a\u062d \u0644\u0625\u062d\u0636\u0627\u0631 \u0646\u0633\u0628\u0629 \u0627\u0644\u0639\u0645\u0648\u0644\u0629 */\r\nLEFT JOIN `tabSales Team` st\r\n    ON st.parent = si.name\r\n   AND st.parenttype = 'Sales Invoice'\r\n\r\nWHERE si.docstatus = 1\r\n;\r\n",
 "ref_doctype": "Payment Entry",
 "reference_report": "",
 "report_name": "Sales_person_eman",
 "report_type": "Query Report",
 "roles": [
  {
   "role": "Accounts Manager"
  },
  {
   "role": "Accounts User"
  },
  {
   "role": "Sales User"
  }
 ],
 "timeout": 0
}